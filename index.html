<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Marshall Stock Market Crash Composite Indicator</title>
<style>
  /* ======= DIGITAL DESIGN THEME ======= */
  :root{
    --bg:#0a0f1e;
    --panel:#0f1630;
    --panel2:#0e1533;
    --border:#1a2346;
    --ink:#e9f0ff;
    --muted:#a6b2d6;
    --accent:#6ea8ff;
    --ok:#0bbf6a;
    --warn:#f2a93b;
    --bad:#e55353;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family: Inter,system-ui,sans-serif}
  header{padding:22px 14px;border-bottom:1px solid var(--border);background:var(--panel);position:sticky;top:0;z-index:5}
  .wrap{max-width:1200px;margin:0 auto;padding:20px 14px}
  h1{margin:0;font-size:26px}
  .sub{color:var(--muted);font-size:14px;margin-top:6px}
  .controls{display:flex;gap:12px;align-items:center;margin-top:14px}
  input,select,button{border:1px solid var(--border);background:var(--panel2);color:var(--ink);border-radius:10px}
  input{padding:10px;min-width:300px}
  .btn{padding:10px 14px;cursor:pointer;font-weight:600;border:none}
  .btn-primary{background:linear-gradient(135deg, #486bff, #2bd6ff);color:#fff}
  .crc-box{margin:20px 0;padding:18px;border-radius:12px;font-weight:700;font-size:20px;text-align:center}
  .crc-green{background:var(--ok)} .crc-amber{background:var(--warn)} .crc-red{background:var(--bad)}
  /* Grid for indicators */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px}
  .card{background:var(--panel);padding:14px;border-radius:12px;border:1px solid var(--border)}
  .id{color:var(--accent);font-weight:600;font-size:14px}
  .val{font-size:20px;font-weight:700;margin-top:6px}
  .date{color:var(--muted);font-size:13px}
  /* Collapsible log */
  details{margin-top:20px;background:var(--panel2);padding:10px;border-radius:8px}
  summary{cursor:pointer;font-weight:600;color:var(--accent)}
  pre{font-size:12px;white-space:pre-wrap;color:var(--muted)}
</style>
</head>
<body>
<header>
  <h1>The Marshall Stock Market Crash Composite Indicator</h1>
  <div class="sub">Live U.S. crash-risk dashboard — powered by 20+ economic & market indicators</div>
</header>
<div class="wrap">
  <div class="controls">
    <input id="apiKey" placeholder="Enter your FRED API key" />
    <button class="btn btn-primary" onclick="run()">Run / Refresh</button>
  </div>
  <div id="crc" class="crc-box">CRC: Loading…</div>
  <div id="grid" class="grid"></div>
  <details>
    <summary>Show Debug Log</summary>
    <pre id="log"></pre>
  </details>
</div>

<script>
const series = [
  {id:"UNRATE", name:"Unemployment rate", invert:1},
  {id:"ICSA", name:"Initial jobless claims (wkly)", invert:1},
  {id:"CPIAUCSL", name:"CPI (headline)", invert:1},
  {id:"CPILFESL", name:"Core CPI", invert:1},
  {id:"PCEPI", name:"PCE prices", invert:1},
  {id:"INDPRO", name:"Industrial production"},
  {id:"TCU", name:"Capacity utilization"},
  {id:"RSAFS", name:"Retail sales (advance)"},
  {id:"HOUST", name:"Housing starts"},
  {id:"PERMIT", name:"Building permits"},
  {id:"SP500", name:"S&P 500 index"},
  {id:"VIXCLS", name:"VIX index", invert:1},
  {id:"T10Y3M", name:"10Y–3M spread"},
  {id:"T10Y2Y", name:"10Y–2Y spread"},
  {id:"DGS10", name:"10Y Treasury yield"},
  {id:"BAMLH0A0HYM2", name:"ICE BofA HY OAS", invert:1},
  {id:"STLFSI4", name:"St. Louis Financial Stress", invert:1},
  {id:"NFCI", name:"Chicago Fed Fin. Conditions", invert:1},
  {id:"UMCSENT", name:"UMich consumer sentiment"},
  {id:"DTWEXBGS", name:"Trade-weighted USD (broad)"}
];

function log(msg){document.getElementById("log").textContent+=msg+"\\n"}

async function fetchSeries(apiKey,id){
  const url=`https://api.codetabs.com/v1/proxy?quest=https://api.stlouisfed.org/fred/series/observations?series_id=${id}&api_key=${apiKey}&file_type=json`;
  try{
    const r=await fetch(url);
    const j=await r.json();
    const obs=j.observations.filter(o=>o.value!=="." && o.value!=="").map(o=>({date:o.date,value:+o.value}));
    return obs.length?obs[obs.length-1]:null;
  }catch(e){log("❌ "+id+" failed");return null}
}

function colorize(score){
  if(score<40)return "crc-green";
  if(score<70)return "crc-amber";
  return "crc-red";
}

async function run(){
  const apiKey=document.getElementById("apiKey").value.trim();
  if(!apiKey){alert("Enter API key");return}
  document.getElementById("crc").textContent="CRC: Loading…";
  document.getElementById("grid").innerHTML="";
  document.getElementById("log").textContent="";

  let scores=[];
  for(const s of series){
    log("Fetching "+s.id+" — "+s.name);
    const obs=await fetchSeries(apiKey,s.id);
    if(!obs)continue;
    const val=obs.value,date=obs.date;
    scores.push(50); // placeholder scoring
    document.getElementById("grid").innerHTML+=`
      <div class="card">
        <div class="id">${s.name}</div>
        <div class="val">${val}</div>
        <div class="date">${date}</div>
      </div>`;
  }
  let avg=Math.round(scores.reduce((a,b)=>a+b,0)/scores.length);
  document.getElementById("crc").textContent=`CRC: ${avg}`;
  document.getElementById("crc").className="crc-box "+colorize(avg);
}
</script>
</body>
</html>
